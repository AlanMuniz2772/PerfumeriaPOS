<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reporte Financiero - Ventas</title>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>

  <a href="../index.html" class="back-button">← Regresar al índice</a>

  <div class="container">
    <h1>Reporte Financiero - Ventas</h1>

    <!-- Formulario de búsqueda por fecha -->
    <div class="form-group">
      <label for="searchDate">Fecha:</label>
      <input type="date" id="searchDate">
      <button onclick="searchReport()" class="submit-btn">Generar Reporte</button>
    </div>

    <!-- Resultados del reporte -->
    <div id="reportResults" style="display:none;">
      <h2>Ventas del día</h2>
      <div id="reportList">
        <!-- Los resultados se insertarán aquí -->
      </div>
    </div>

  </div>

  <script>
    function searchReport() {
      const searchDate = document.getElementById('searchDate').value;
      console.log('Fecha seleccionada:', searchDate); 
      if (!searchDate) {
        alert("Por favor ingresa una fecha.");
        return;
      }

      fetch(`http://localhost:3000/reporte_financiero/${searchDate}`)
        .then(response => {
          if (!response.ok) {
            throw new Error("Error en la solicitud, estado: " + response.status);
          }
          return response.json(); // Parseamos la respuesta como JSON si es correcta
        })
        .then(data => {
          console.log('Datos recibidos:', data);
          const reportList = document.getElementById('reportList');

          // Asegúrate de que la respuesta esté bien estructurada como arrays
          const { idVenta, idCliente, idTipo, saldoAbonado, ventaTotal, fechaVenta } = data;

          // Limpiar los resultados previos
          reportList.innerHTML = '';

          // Imprimir cada venta manualmente
          for (let i = 0; i < idVenta.length; i++) {
            const reportItem = `
              <div class="report-item">
                <p><strong>ID Venta:</strong> ${idVenta[i]}</p>
                <p><strong>ID Cliente:</strong> ${idCliente[i]}</p>
                <p><strong>ID Tipo:</strong> ${idTipo[i]}</p>
                <p><strong>Saldo Abonado:</strong> $${parseFloat(saldoAbonado[i]).toFixed(2)}</p>
                <p><strong>Total Venta:</strong> $${parseFloat(ventaTotal[i]).toFixed(2)}</p>
                <p><strong>Fecha:</strong> ${fechaVenta[i]}</p>
              </div>
            `;
            reportList.innerHTML += reportItem;
          }

          // Mostrar los resultados
          document.getElementById('reportResults').style.display = 'block';
        })
        .catch(error => {
          alert("Error al obtener el reporte: " + error);
        });
    }
  </script>

</body>
</html>
