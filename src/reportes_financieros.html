<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reportes Financieros - Tienda de Perfumes</title>
  <link rel="stylesheet" href="../styles.css">
  <script defer>
    async function generarReporte() {
        const inicio = document.getElementById("inicio").value;
        const fin = document.getElementById("fin").value;
        const mensaje = document.getElementById("mensaje");
        const tbody = document.getElementById("reporte-body");
        tbody.innerHTML = ""; // Limpiar tabla
        
        if (!inicio || !fin) {
            mensaje.innerText = "Debe seleccionar un rango de fechas válido.";
            return;
        }

        // Convertir las fechas al formato yyyy-mm-dd
        const fechaInicio = new Date(inicio).toISOString().split('T')[0];
        const fechaFin = new Date(fin).toISOString().split('T')[0];
        
        try {
            const response = await fetch(`/reportes?inicio=${fechaInicio}&fin=${fechaFin}`);
            const reportes = await response.json();
            
            console.log("Datos recibidos del backend:", reportes); // Ver los datos que llegan
            
            if (response.ok) {
                // Si se obtiene el reporte con éxito
                if (reportes.length > 0) {
                    reportes.forEach(reporte => {
                        const fila = `<tr>
                            <td>${reporte.IDVENTA}</td>
                            <td>${reporte.Cliente}</td>
                            <td>${reporte.ProductosComprados}</td>
                            <td>$${reporte.PagoTotal.toFixed(2)}</td>
                            <td>$${reporte.Abono.toFixed(2)}</td>
                        </tr>`;
                        tbody.innerHTML += fila;
                    });
                    mensaje.innerText = "Reporte generado exitosamente.";
                } else {
                    mensaje.innerText = "No se encontraron ventas en este rango de fechas.";
                }
            } else {
                mensaje.innerText = "Error al obtener el reporte.";
            }
        } catch (error) {
            console.error("Error al generar reporte:", error);
            mensaje.innerText = "Hubo un error al generar el reporte.";
        }
    }
  </script>
</head>
<body>
  
  <a href="../index.html" class="back-button">← Regresar al índice</a>

  <h1>Reporte Financiero</h1>
  
  <label for="inicio">Fecha de inicio:</label>
  <input type="date" id="inicio">
  
  <label for="fin">Fecha de fin:</label>
  <input type="date" id="fin">
  
  <button onclick="generarReporte()">Generar Reporte</button>
  
  <p id="mensaje" style="color: green;"></p>
  
  <table border="1">
    <thead>
      <tr>
        <th>ID Venta</th>
        <th>Cliente</th>
        <th>Productos Comprados</th>
        <th>Pago Total</th>
        <th>Abono</th>
      </tr>
    </thead>
    <tbody id="reporte-body"></tbody>
  </table>

</body>
</html>
